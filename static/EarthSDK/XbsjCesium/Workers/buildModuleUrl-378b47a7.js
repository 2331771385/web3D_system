define(["exports","./when-cbf8cd21","./Check-35e1a91d","./RuntimeError-f4c64df1"],function(e,h,r,p){"use strict";function o(e){if(e instanceof o)this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment;else if(e){var t=n.exec(e);this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5]}}o.prototype.scheme=null,o.prototype.authority=null,o.prototype.path="",o.prototype.query=null,o.prototype.fragment=null;var n=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");o.prototype.getScheme=function(){return this.scheme},o.prototype.getAuthority=function(){return this.authority},o.prototype.getPath=function(){return this.path},o.prototype.getQuery=function(){return this.query},o.prototype.getFragment=function(){return this.fragment},o.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},o.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},o.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},o.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(s,a).replace(t,u)),this.path&&(this.path=this.path.replace(t,u)),this.query&&(this.query=this.query.replace(t,u)),this.fragment&&(this.fragment=this.fragment.replace(t,u))};var t=/%[0-9a-z]{2}/gi,i=/[a-zA-Z0-9\-\._~]/,s=/(.*@)?([^@:]*)(:.*)?/;function u(e){var t=unescape(e);return i.test(t)?t:e.toUpperCase()}function a(e,t,r,n){return(t||"")+r.toLowerCase()+(n||"")}function f(e,t){if(null===e||"object"!=typeof e)return e;t=h.defaultValue(t,!1);var r=new e.constructor;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t&&(i=f(i,t)),r[n]=i}return r}function c(e,t,r){r=h.defaultValue(r,!1);var n,i,o,s={},u=h.defined(e),a=h.defined(t);if(u)for(n in e)e.hasOwnProperty(n)&&(i=e[n],a&&r&&"object"==typeof i&&t.hasOwnProperty(n)?(o=t[n],s[n]="object"==typeof o?c(i,o,r):i):s[n]=i);if(a)for(n in t)t.hasOwnProperty(n)&&!s.hasOwnProperty(n)&&(o=t[n],s[n]=o);return s}function l(e,t){var r;return"undefined"!=typeof document&&(r=document),l._implementation(e,t,r)}o.prototype.resolve=function(e){var t=new o;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?t.path=this.path:e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments(),t.query=this.query))),t.fragment=this.fragment,t},o.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),r=[],n=""==t[0];n&&t.shift();for(""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?r.pop():"."!=e&&r.push(e);"."!=e&&".."!=e||r.push(""),n&&r.unshift(""),this.path=r.join("/")},o.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},l._implementation=function(e,t,r){if(!h.defined(t)){if(void 0===r)return e;t=h.defaultValue(r.baseURI,r.location.href)}var n=new o(t);return new o(e).resolve(n).toString()};var d,m=/^blob:/i;function y(e){return m.test(e)}var v=/^data:/i;function g(e){return v.test(e)}var q=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),b=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3});function w(e){e=h.defaultValue(e,h.defaultValue.EMPTY_OBJECT);var t=h.defaultValue(e.throttleByServer,!1),r=h.defaultValue(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=h.defaultValue(e.priority,0),this.throttle=r,this.throttleByServer=t,this.type=h.defaultValue(e.type,b.OTHER),this.serverKey=void 0,this.state=q.UNISSUED,this.deferred=void 0,this.cancelled=!1}function A(e,t,r){this.statusCode=e,this.response=t,this.responseHeaders=r,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var i=r[n],o=i.indexOf(": ");if(0<o){var s=i.substring(0,o),u=i.substring(o+2);t[s]=u}}return t}(this.responseHeaders))}function _(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function R(e,t){return t-e}function E(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function O(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}w.prototype.cancel=function(){this.cancelled=!0},w.prototype.clone=function(e){return h.defined(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new w(this)},A.prototype.toString=function(){var e="Request has failed.";return h.defined(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(_.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),_.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var r=this;return function(){r.removeEventListener(e,t)}},_.prototype.removeEventListener=function(e,t){for(var r=this._listeners,n=this._scopes,i=-1,o=0;o<r.length;o++)if(r[o]===e&&n[o]===t){i=o;break}return-1!==i&&(this._insideRaiseEvent?(this._toRemove.push(i),r[i]=void 0,n[i]=void 0):(r.splice(i,1),n.splice(i,1)),!0)},_.prototype.raiseEvent=function(){var e;this._insideRaiseEvent=!0;var t=this._listeners,r=this._scopes,n=t.length;for(e=0;e<n;e++){var i=t[e];h.defined(i)&&t[e].apply(r[e],arguments)}var o=this._toRemove;if(0<(n=o.length)){for(o.sort(R),e=0;e<n;e++){var s=o[e];t.splice(s,1),r.splice(s,1)}o.length=0}this._insideRaiseEvent=!1},Object.defineProperties(E.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&0<e&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),E.prototype.reserve=function(e){e=h.defaultValue(e,this._length),this._array.length=e},E.prototype.heapify=function(e){e=h.defaultValue(e,0);for(var t=this._length,r=this._comparator,n=this._array,i=-1,o=!0;o;){var s=2*(e+1),u=s-1;i=u<t&&r(n[u],n[e])<0?u:e,s<t&&r(n[s],n[i])<0&&(i=s),i!==e?(O(n,i,e),e=i):o=!1}},E.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);0<=t;--t)this.heapify(t)},E.prototype.insert=function(e){var t,r=this._array,n=this._comparator,i=this._maximumLength,o=this._length++;for(o<r.length?r[o]=e:r.push(e);0!==o;){var s=Math.floor((o-1)/2);if(!(n(r[o],r[s])<0))break;O(r,o,s),o=s}return h.defined(i)&&this._length>i&&(t=r[i],this._length=i),t},E.prototype.pop=function(e){if(e=h.defaultValue(e,0),0!==this._length){var t=this._array,r=t[e];return O(t,e,--this._length),this.heapify(e),r}};var C={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},I=20,S=new E({comparator:function(e,t){return e.priority-t.priority}});S.maximumLength=I,S.reserve(I);var T=[],U={},B="undefined"!=typeof document?new o(document.location.href):new o,x=new _;function L(){}function P(e){h.defined(e.priorityFunction)&&(e.priority=e.priorityFunction())}function V(e){var t=h.defaultValue(L.requestsByServer[e],L.maximumRequestsPerServer);return U[e]<t}function D(e){return e.state===q.UNISSUED&&(e.state=q.ISSUED,e.deferred=h.when.defer()),e.deferred.promise}function j(e){var t=D(e);return e.state=q.ACTIVE,T.push(e),++C.numberOfActiveRequests,++C.numberOfActiveRequestsEver,++U[e.serverKey],e.requestFunction().then(function(t){return function(e){t.state!==q.CANCELLED&&(--C.numberOfActiveRequests,--U[t.serverKey],x.raiseEvent(),t.state=q.RECEIVED,t.deferred.resolve(e))}}(e)).otherwise(function(t){return function(e){t.state!==q.CANCELLED&&(++C.numberOfFailedRequests,--C.numberOfActiveRequests,--U[t.serverKey],x.raiseEvent(e),t.state=q.FAILED,t.deferred.reject(e))}}(e)),t}function F(e){var t=e.state===q.ACTIVE;e.state=q.CANCELLED,++C.numberOfCancelledRequests,e.deferred.reject(),t&&(--C.numberOfActiveRequests,--U[e.serverKey],++C.numberOfCancelledActiveRequests),h.defined(e.cancelFunction)&&e.cancelFunction()}L.maximumRequests=50,L.maximumRequestsPerServer=6,L.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},L.throttleRequests=!0,L.debugShowStatistics=!1,L.requestCompletedEvent=x,Object.defineProperties(L,{statistics:{get:function(){return C}},priorityHeapLength:{get:function(){return I},set:function(e){if(e<I)for(;S.length>e;){F(S.pop())}I=e,S.maximumLength=e,S.reserve(e)}}}),L.update=function(){var e,t,r=0,n=T.length;for(e=0;e<n;++e)(t=T[e]).cancelled&&F(t),t.state===q.ACTIVE?0<r&&(T[e-r]=t):++r;T.length-=r;var i=S.internalArray,o=S.length;for(e=0;e<o;++e)P(i[e]);S.resort();for(var s=Math.max(L.maximumRequests-T.length,0),u=0;u<s&&0<S.length;)(t=S.pop()).cancelled?F(t):!t.throttleByServer||V(t.serverKey)?(j(t),++u):F(t);!function(){if(!L.debugShowStatistics)return;0===C.numberOfActiveRequests&&0<C.lastNumberOfActiveRequests&&(0<C.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+C.numberOfAttemptedRequests),C.numberOfAttemptedRequests=0),0<C.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+C.numberOfCancelledRequests),C.numberOfCancelledRequests=0),0<C.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+C.numberOfCancelledActiveRequests),C.numberOfCancelledActiveRequests=0),0<C.numberOfFailedRequests&&(console.log("Number of failed requests: "+C.numberOfFailedRequests),C.numberOfFailedRequests=0));C.lastNumberOfActiveRequests=C.numberOfActiveRequests}()},L.getServerKey=function(e){var t=new o(e).resolve(B);t.normalize();var r=t.authority;/:/.test(r)||(r=r+":"+("https"===t.scheme?"443":"80"));var n=U[r];return h.defined(n)||(U[r]=0),r},L.request=function(e){if(g(e.url)||y(e.url))return x.raiseEvent(),e.state=q.RECEIVED,e.requestFunction();if(++C.numberOfAttemptedRequests,h.defined(e.serverKey)||(e.serverKey=L.getServerKey(e.url)),!L.throttleRequests||!e.throttleByServer||V(e.serverKey)){if(!L.throttleRequests||!e.throttle)return j(e);if(!(T.length>=L.maximumRequests)){P(e);var t=S.insert(e);if(h.defined(t)){if(t===e)return;F(t)}return D(e)}}},L.clearForSpecs=function(){for(;0<S.length;){F(S.pop())}for(var e=T.length,t=0;t<e;++t)F(T[t]);T.length=0,U={},C.numberOfAttemptedRequests=0,C.numberOfActiveRequests=0,C.numberOfCancelledRequests=0,C.numberOfCancelledActiveRequests=0,C.numberOfFailedRequests=0,C.numberOfActiveRequestsEver=0,C.lastNumberOfActiveRequests=0},L.numberOfActiveRequestsByServer=function(e){return U[e]},L.requestHeap=S;var M={},N={};M.add=function(e,t){var r=e.toLowerCase()+":"+t;h.defined(N[r])||(N[r]=!0)},M.remove=function(e,t){var r=e.toLowerCase()+":"+t;h.defined(N[r])&&delete N[r]},M.contains=function(e){var t=function(e){var t=new o(e);t.normalize();var r=t.getAuthority();if(h.defined(r)){if(-1!==r.indexOf("@"))r=r.split("@")[1];if(-1===r.indexOf(":")){var n=t.getScheme();if(h.defined(n)||(n=(n=window.location.protocol).substring(0,n.length-1)),"http"===n)r+=":80";else{if("https"!==n)return;r+=":443"}}return r}}(e);return!(!h.defined(t)||!h.defined(N[t]))},M.clear=function(){N={}};var k,H=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),(e.responseType="blob")===e.responseType}catch(e){return!1}}();function Y(e,t,r,n){var i,o=e.query;if(!h.defined(o)||0===o.length)return{};if(-1===o.indexOf("=")){var s={};s[o]=void 0,i=s}else i=function(e){var t={};if(""===e)return t;for(var r=e.replace(/\+/g,"%20").split(/[&;]/),n=0,i=r.length;n<i;++n){var o=r[n].split("="),s=decodeURIComponent(o[0]),u=o[1];u=h.defined(u)?decodeURIComponent(u):"";var a=t[s];"string"==typeof a?t[s]=[a,u]:Array.isArray(a)?a.push(u):t[s]=u}return t}(o);t._queryParameters=r?z(i,t._queryParameters,n):i,e.query=void 0}function J(e,t){var r=t._queryParameters,n=Object.keys(r);1!==n.length||h.defined(r[n[0]])?e.query=function(e){var t="";for(var r in e)if(e.hasOwnProperty(r)){var n=e[r],i=encodeURIComponent(r)+"=";if(Array.isArray(n))for(var o=0,s=n.length;o<s;++o)t+=i+encodeURIComponent(n[o])+"&";else t+=i+encodeURIComponent(n)+"&"}return t=t.slice(0,-1)}(r):e.query=n[0]}function X(e,t){return h.defined(e)?h.defined(e.clone)?e.clone():f(e):t}function K(e){if(e.state===q.ISSUED||e.state===q.ACTIVE)throw new p.RuntimeError("The Resource is already being fetched.");e.state=q.UNISSUED,e.deferred=void 0}function z(e,t,r){if(!r)return c(e,t);var n=f(e,!0);for(var i in t)if(t.hasOwnProperty(i)){var o=n[i],s=t[i];h.defined(o)?(Array.isArray(o)||(o=n[i]=[o]),n[i]=o.concat(s)):n[i]=Array.isArray(s)?s.slice():s}return n}function Q(e){"string"==typeof(e=h.defaultValue(e,h.defaultValue.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=X(e.templateValues,{}),this._queryParameters=X(e.queryParameters,{}),this.headers=X(e.headers,{}),this.request=h.defaultValue(e.request,new w),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=h.defaultValue(e.retryAttempts,0),this._retryCount=0;var t=new o(e.url);Y(t,this,!0,!0),t.fragment=void 0,this._url=t.toString()}function W(e){var r=e.resource,n=e.flipY,i=e.preferImageBitmap,o=r.request;o.url=r.url,o.requestFunction=function(){var e=!1;r.isDataUri||r.isBlobUri||(e=r.isCrossOriginUrl);var t=h.when.defer();return Q._Implementations.createImage(o,e,t,n,i),t.promise};var t=L.request(o);if(h.defined(t))return t.otherwise(function(t){return o.state!==q.FAILED?h.when.reject(t):r.retryOnError(t).then(function(e){return e?(o.state=q.UNISSUED,o.deferred=void 0,W({resource:r,flipY:n,preferImageBitmap:i})):h.when.reject(t)})})}Q.createIfNeeded=function(e){return e instanceof Q?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new Q({url:e})},Q.supportsImageBitmapOptions=function(){if(h.defined(k))return k;if("function"!=typeof createImageBitmap)return k=h.when.resolve(!1);return k=Q.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then(function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(e){return!0}).otherwise(function(){return!1})},Object.defineProperties(Q,{isBlobSupported:{get:function(){return H}}}),Object.defineProperties(Q.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new o(e);Y(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){var t=new o(e);t.normalize();var r=t.path,n=r.lastIndexOf("/");return-1!==n&&(r=r.substr(n+1)),r=-1===(n=r.lastIndexOf("."))?"":r.substr(n+1)}(this._url)}},isDataUri:{get:function(){return g(this._url)}},isBlobUri:{get:function(){return y(this._url)}},isCrossOriginUrl:{get:function(){return function(e){h.defined(d)||(d=document.createElement("a")),d.href=window.location.href;var t=d.host,r=d.protocol;return d.href=e,d.href=d.href,r!==d.protocol||t!==d.host}(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}}),Q.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var r=new o(this._url);e&&J(r,this);var n=r.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),i=this._templateValues;return n=n.replace(/{(.*?)}/g,function(e,t){var r=i[t];return h.defined(r)?encodeURIComponent(r):e}),t&&h.defined(this.proxy)&&(n=this.proxy.getURL(n)),n},Q.prototype.setQueryParameters=function(e,t){this._queryParameters=t?z(this._queryParameters,e,!1):z(e,this._queryParameters,!1)},Q.prototype.appendQueryParameters=function(e){this._queryParameters=z(e,this._queryParameters,!0)},Q.prototype.setTemplateValues=function(e,t){this._templateValues=t?c(this._templateValues,e):c(e,this._templateValues)},Q.prototype.getDerivedResource=function(e){var t=this.clone();if(t._retryCount=0,h.defined(e.url)){var r=new o(e.url);Y(r,t,!0,h.defaultValue(e.preserveQueryParameters,!1)),r.fragment=void 0,t._url=r.resolve(new o(l(this._url))).toString()}return h.defined(e.queryParameters)&&(t._queryParameters=c(e.queryParameters,t._queryParameters)),h.defined(e.templateValues)&&(t._templateValues=c(e.templateValues,t.templateValues)),h.defined(e.headers)&&(t.headers=c(e.headers,t.headers)),h.defined(e.proxy)&&(t.proxy=e.proxy),h.defined(e.request)&&(t.request=e.request),h.defined(e.retryCallback)&&(t.retryCallback=e.retryCallback),h.defined(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t},Q.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return h.when(!1);var r=this;return h.when(t(this,e)).then(function(e){return++r._retryCount,e})},Q.prototype.clone=function(e){return h.defined(e)||(e=new Q({url:this._url})),e._url=this._url,e._queryParameters=f(this._queryParameters),e._templateValues=f(this._templateValues),e.headers=f(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},Q.prototype.getBaseUri=function(e){return function(e,t){var r="",n=e.lastIndexOf("/");return-1!==n&&(r=e.substring(0,n+1)),t&&(e=new o(e),h.defined(e.query)&&(r+="?"+e.query),h.defined(e.fragment)&&(r+="#"+e.fragment)),r}(this.getUrlComponent(e),e)},Q.prototype.appendForwardSlash=function(){this._url=function(e){return 0!==e.length&&"/"===e[e.length-1]||(e+="/"),e}(this._url)},Q.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},Q.fetchArrayBuffer=function(e){return new Q(e).fetchArrayBuffer()},Q.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},Q.fetchBlob=function(e){return new Q(e).fetchBlob()},Q.prototype.fetchImage=function(e){e=h.defaultValue(e,h.defaultValue.EMPTY_OBJECT);var t=h.defaultValue(e.preferImageBitmap,!1),r=h.defaultValue(e.preferBlob,!1),n=h.defaultValue(e.flipY,!1);if(K(this.request),!H||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return W({resource:this,flipY:n,preferImageBitmap:t});var i,o,s,u=this.fetchBlob();return h.defined(u)?Q.supportsImageBitmapOptions().then(function(e){return i=e&&t,u}).then(function(e){if(h.defined(e)){if(s=e,i)return Q.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});var t=window.URL.createObjectURL(e);return W({resource:o=new Q({url:t}),flipY:n,preferImageBitmap:!1})}}).then(function(e){if(h.defined(e))return e.blob=s,i||window.URL.revokeObjectURL(o.url),e}).otherwise(function(e){return h.defined(o)&&window.URL.revokeObjectURL(o.url),e.blob=s,h.when.reject(e)}):void 0},Q.fetchImage=function(e){return new Q(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},Q.prototype.fetchText=function(){return this.fetch({responseType:"text"})},Q.fetchText=function(e){return new Q(e).fetchText()},Q.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(h.defined(e))return e.then(function(e){if(h.defined(e))return JSON.parse(e)})},Q.fetchJson=function(e){return new Q(e).fetchJson()},Q.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},Q.fetchXML=function(e){return new Q(e).fetchXML()},Q.prototype.fetchJsonp=function(e){var t;for(e=h.defaultValue(e,"callback"),K(this.request);t="loadJsonp"+Math.random().toString().substring(2,8),h.defined(window[t]););return function r(n,i,o){var e={};e[i]=o;n.setQueryParameters(e);var s=n.request;s.url=n.url;s.requestFunction=function(){var t=h.when.defer();return window[o]=function(e){t.resolve(e);try{delete window[o]}catch(e){window[o]=void 0}},Q._Implementations.loadAndExecuteScript(n.url,o,t),t.promise};var t=L.request(s);if(!h.defined(t))return;return t.otherwise(function(t){return s.state!==q.FAILED?h.when.reject(t):n.retryOnError(t).then(function(e){return e?(s.state=q.UNISSUED,s.deferred=void 0,r(n,i,o)):h.when.reject(t)})})}(this,e,t)},Q.fetchJsonp=function(e){return new Q(e).fetchJsonp(e.callbackParameterName)},Q.prototype._makeRequest=function(u){var a=this;K(a.request);var f=a.request;f.url=a.url,f.requestFunction=function(){var e=u.responseType,t=c(u.headers,a.headers),r=u.overrideMimeType,n=u.method,i=u.data,o=h.when.defer(),s=Q._Implementations.loadWithXhr(a.url,e,n,i,t,o,r);return h.defined(s)&&h.defined(s.abort)&&(f.cancelFunction=function(){s.abort()}),o.promise};var e=L.request(f);if(h.defined(e))return e.then(function(e){return e}).otherwise(function(t){return f.state!==q.FAILED?h.when.reject(t):a.retryOnError(t).then(function(e){return e?(f.state=q.UNISSUED,f.deferred=void 0,a.fetch(u)):h.when.reject(t)})})};var G=/^data:(.*?)(;base64)?,(.*)$/;function $(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function Z(e,t){for(var r=$(e,t),n=new ArrayBuffer(r.length),i=new Uint8Array(n),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return n}function ee(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}Q.prototype.fetch=function(e){return(e=X(e,{})).method="GET",this._makeRequest(e)},Q.fetch=function(e){return new Q(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Q.prototype.delete=function(e){return(e=X(e,{})).method="DELETE",this._makeRequest(e)},Q.delete=function(e){return new Q(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},Q.prototype.head=function(e){return(e=X(e,{})).method="HEAD",this._makeRequest(e)},Q.head=function(e){return new Q(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Q.prototype.options=function(e){return(e=X(e,{})).method="OPTIONS",this._makeRequest(e)},Q.options=function(e){return new Q(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Q.prototype.post=function(e,t){return r.Check.defined("data",e),(t=X(t,{})).method="POST",t.data=e,this._makeRequest(t)},Q.post=function(e){return new Q(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Q.prototype.put=function(e,t){return r.Check.defined("data",e),(t=X(t,{})).method="PUT",t.data=e,this._makeRequest(t)},Q.put=function(e){return new Q(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},Q.prototype.patch=function(e,t){return r.Check.defined("data",e),(t=X(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},Q.patch=function(e){return new Q(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},(Q._Implementations={}).createImage=function(n,i,o,s,u){var a=n.url;Q.supportsImageBitmapOptions().then(function(e){if(e&&u){var t=h.when.defer(),r=Q._Implementations.loadWithXhr(a,"blob","GET",void 0,void 0,t,void 0,void 0,void 0);return h.defined(r)&&h.defined(r.abort)&&(n.cancelFunction=function(){r.abort()}),t.promise.then(function(e){if(h.defined(e))return Q.createImageBitmapFromBlob(e,{flipY:s,premultiplyAlpha:!1});o.reject(new p.RuntimeError("Successfully retrieved "+a+" but it contained no content."))}).then(o.resolve)}!function(e,t,r){var n=new Image;n.onload=function(){r.resolve(n)},n.onerror=function(e){r.reject(e)},t&&(M.contains(e)?n.crossOrigin="use-credentials":n.crossOrigin=""),n.src=e}(a,i,o)}).otherwise(o.reject)},Q.createImageBitmapFromBlob=function(e,t){return r.Check.defined("options",t),r.Check.typeOf.bool("options.flipY",t.flipY),r.Check.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var te="undefined"==typeof XMLHttpRequest;Q._Implementations.loadWithXhr=function(e,i,o,t,r,s,n){var u=G.exec(e);if(null===u){if(!te){var a=new XMLHttpRequest;if(M.contains(e)&&(a.withCredentials=!0),a.open(o,e,!0),h.defined(n)&&h.defined(a.overrideMimeType)&&a.overrideMimeType(n),h.defined(r))for(var f in r)r.hasOwnProperty(f)&&a.setRequestHeader(f,r[f]);h.defined(i)&&(a.responseType=i);var c=!1;return"string"==typeof e&&(c=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),a.onload=function(){if(!(a.status<200||300<=a.status)||c&&0===a.status){var e=a.response,t=a.responseType;if("HEAD"===o||"OPTIONS"===o){var r=a.getAllResponseHeaders().trim().split(/[\r\n]+/),n={};return r.forEach(function(e){var t=e.split(": "),r=t.shift();n[r]=t.join(": ")}),void s.resolve(n)}if(204===a.status)s.resolve();else if(!h.defined(e)||h.defined(i)&&t!==i)if("json"===i&&"string"==typeof e)try{s.resolve(JSON.parse(e))}catch(e){s.reject(e)}else(""===t||"document"===t)&&h.defined(a.responseXML)&&a.responseXML.hasChildNodes()?s.resolve(a.responseXML):""!==t&&"text"!==t||!h.defined(a.responseText)?s.reject(new p.RuntimeError("Invalid XMLHttpRequest response type.")):s.resolve(a.responseText);else s.resolve(e)}else s.reject(new A(a.status,a.response,a.getAllResponseHeaders()))},a.onerror=function(e){s.reject(new A)},a.send(t),a}!function(e,n,t,r,i,o){var s=require("url").parse(e),u="https:"===s.protocol?require("https"):require("http"),a=require("zlib"),f={protocol:s.protocol,hostname:s.hostname,port:s.port,path:s.path,query:s.query,method:t,headers:i};u.request(f).on("response",function(t){if(t.statusCode<200||300<=t.statusCode)o.reject(new A(t.statusCode,t,t.headers));else{var r=[];t.on("data",function(e){r.push(e)}),t.on("end",function(){var e=Buffer.concat(r);"gzip"===t.headers["content-encoding"]?a.gunzip(e,function(e,t){e?o.reject(new p.RuntimeError("Error decompressing response.")):o.resolve(ee(t,n))}):o.resolve(ee(e,n))})}}).on("error",function(e){o.reject(new A)}).end()}(e,i,o,0,r,s)}else s.resolve(function(e,t){t=h.defaultValue(t,"");var r=e[1],n=!!e[2],i=e[3];switch(t){case"":case"text":return $(n,i);case"arraybuffer":return Z(n,i);case"blob":var o=Z(n,i);return new Blob([o],{type:r});case"document":return(new DOMParser).parseFromString($(n,i),r);case"json":return JSON.parse($(n,i))}}(u,i))},Q._Implementations.loadAndExecuteScript=function(e,t,r){return function(e){var t=h.when.defer(),r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];return r.onload=function(){r.onload=void 0,n.removeChild(r),t.resolve()},r.onerror=function(e){t.reject(e)},n.appendChild(r),t.promise}(e).otherwise(r.reject)},(Q._DefaultImplementations={}).createImage=Q._Implementations.createImage,Q._DefaultImplementations.loadWithXhr=Q._Implementations.loadWithXhr,Q._DefaultImplementations.loadAndExecuteScript=Q._Implementations.loadAndExecuteScript,Q.DEFAULT=Object.freeze(new Q({url:"undefined"==typeof document?"":document.location.href.split("?")[0]}));var re,ne,ie,oe=/((?:.*\/)|^)Cesium\.js$/;function se(e){return"undefined"==typeof document?e:(h.defined(re)||(re=document.createElement("a")),re.href=e,re.href=re.href,re.href)}function ue(){return h.defined(ne)||(e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&h.defined(define.amd)&&!define.amd.toUrlUndefined&&h.defined(require.toUrl)?l("..",ce("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t){var n=e[t].getAttribute("src"),i=oe.exec(n);if(null!==i)return i[1]}}(),(ne=new Q({url:se(e)})).appendForwardSlash()),ne;var e}function ae(e){return se(require.toUrl("../"+e))}function fe(e){return ue().getDerivedResource({url:e}).url}function ce(e){return h.defined(ie)||(ie="object"==typeof define&&h.defined(define.amd)&&!define.amd.toUrlUndefined&&h.defined(require.toUrl)?ae:fe),ie(e)}ce._cesiumScriptRegex=oe,ce._buildModuleUrlFromBaseUrl=fe,ce._clearBaseResource=function(){ne=void 0},ce.setBaseUrl=function(e){ne=Q.DEFAULT.getDerivedResource({url:e})},ce.getCesiumBaseUrl=ue,e.Resource=Q,e.buildModuleUrl=ce});
